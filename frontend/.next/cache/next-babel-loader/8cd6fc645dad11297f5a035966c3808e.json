{"ast":null,"code":"import _Object$defineProperty from \"@babel/runtime-corejs2/core-js/object/define-property\";\nimport _Object$defineProperties from \"@babel/runtime-corejs2/core-js/object/define-properties\";\nimport _Object$getOwnPropertyDescriptors from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptors\";\nimport _Object$getOwnPropertyDescriptor from \"@babel/runtime-corejs2/core-js/object/get-own-property-descriptor\";\nimport _Object$getOwnPropertySymbols from \"@babel/runtime-corejs2/core-js/object/get-own-property-symbols\";\nimport _Object$keys from \"@babel/runtime-corejs2/core-js/object/keys\";\nimport _defineProperty from \"@babel/runtime-corejs2/helpers/esm/defineProperty\";\nvar _jsxFileName = \"/Users/huirenchuah/Desktop/travelblog/frontend/components/auth/ProfileUpdate.js\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = _Object$keys(object); if (_Object$getOwnPropertySymbols) { var symbols = _Object$getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return _Object$getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (_Object$getOwnPropertyDescriptors) { _Object$defineProperties(target, _Object$getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { _Object$defineProperty(target, key, _Object$getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nimport Link from \"next/link\";\nimport { useState, useEffect } from \"react\";\nimport Router from \"next/router\";\nimport { getCookie, isAuth, updateUser } from \"../../actions/auth\";\nimport { getProfile, update } from \"../../actions/user\";\nimport { API } from \"../../config\";\nimport ReactImageFallback from \"react-image-fallback\";\nimport { Button } from \"@material-ui/core\";\n\nconst ProfileUpdate = () => {\n  const {\n    0: values,\n    1: setValues\n  } = useState({\n    username: \"\",\n    name: \"\",\n    email: \"\",\n    about: \"\",\n    password: \"\",\n    error: false,\n    success: false,\n    loading: false,\n    userData: false && new FormData(),\n    username_for_photo: \"\"\n  });\n  const token = getCookie(\"token\");\n  const {\n    username,\n    name,\n    email,\n    about,\n    password,\n    error,\n    success,\n    loading,\n    username_for_photo,\n    userData\n  } = values;\n\n  const init = () => {\n    getProfile(token).then(data => {\n      if (data.error) {\n        setValues(_objectSpread({}, values, {\n          error: data.error\n        }));\n      } else {\n        setValues(_objectSpread({}, values, {\n          username: data.username,\n          username_for_photo: data.username,\n          name: data.name,\n          email: data.email,\n          about: data.about\n        }));\n      }\n    });\n  };\n\n  useEffect(() => {\n    init();\n    setValues(_objectSpread({}, values, {\n      userData: new FormData()\n    }));\n  }, []);\n\n  const handleChange = name => e => {\n    // console.log(e.target.value);\n    let value = name === \"photo\" ? e.target.files[0] : e.target.value;\n    userData.set(name, value);\n    setValues(_objectSpread({}, values, {\n      [name]: value,\n      userData,\n      error: false,\n      success: false\n    })); // console.log(...userData)\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    console.log(...userData);\n    setValues(_objectSpread({}, values, {\n      loading: true\n    }));\n    update(token, userData).then(data => {\n      if (data.error) {\n        setValues(_objectSpread({}, values, {\n          error: data.error,\n          success: false,\n          loading: false\n        }));\n      } else {\n        // console.log(data)\n        updateUser(data, () => {\n          setValues(_objectSpread({}, values, {\n            // usernameImgSrc: data.username,\n            username: data.username,\n            name: data.name,\n            email: data.email,\n            about: data.about,\n            password: \"\",\n            success: true,\n            loading: false\n          }));\n        });\n      }\n    });\n  };\n\n  const profileUpdateForm = () => __jsx(\"form\", {\n    onSubmit: handleSubmit,\n    className: \"pl-5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 109\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110\n    },\n    __self: this\n  }, __jsx(\"label\", {\n    className: \"\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111\n    },\n    __self: this\n  }, __jsx(Button, {\n    variant: \"contained\",\n    color: \"default\",\n    className: classes.button,\n    startIcon: __jsx(CloudUploadIcon, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 116\n      },\n      __self: this\n    }),\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112\n    },\n    __self: this\n  }, \"Featured photo\", __jsx(\"input\", {\n    onChange: handleChange(\"photo\"),\n    type: \"file\",\n    accept: \"image/*\",\n    hidden: true,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119\n    },\n    __self: this\n  })))), __jsx(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128\n    },\n    __self: this\n  }, __jsx(\"label\", {\n    className: \"text-muted\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129\n    },\n    __self: this\n  }, \"Username\"), __jsx(\"input\", {\n    onChange: handleChange(\"username\"),\n    type: \"text\",\n    value: username,\n    className: \"form-control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 137\n    },\n    __self: this\n  }, __jsx(\"label\", {\n    className: \"text-muted\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 138\n    },\n    __self: this\n  }, \"Name\"), __jsx(\"input\", {\n    onChange: handleChange(\"name\"),\n    type: \"text\",\n    value: name,\n    className: \"form-control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 139\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146\n    },\n    __self: this\n  }, __jsx(\"label\", {\n    className: \"text-muted\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 147\n    },\n    __self: this\n  }, \"Email\"), __jsx(\"input\", {\n    onChange: handleChange(\"email\"),\n    type: \"text\",\n    value: email,\n    className: \"form-control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 148\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 155\n    },\n    __self: this\n  }, __jsx(\"label\", {\n    className: \"text-muted\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 156\n    },\n    __self: this\n  }, \"About\"), __jsx(\"textarea\", {\n    onChange: handleChange(\"about\"),\n    type: \"text\",\n    value: about,\n    className: \"form-control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 157\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"form-group\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164\n    },\n    __self: this\n  }, __jsx(\"label\", {\n    className: \"text-muted\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 165\n    },\n    __self: this\n  }, \"Password\"), __jsx(\"input\", {\n    onChange: handleChange(\"password\"),\n    type: \"password\",\n    value: password,\n    className: \"form-control\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 166\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 173\n    },\n    __self: this\n  }, __jsx(Button, {\n    variant: \"contained\",\n    color: \"primary\",\n    type: \"submit\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 174\n    },\n    __self: this\n  }, \"Submit\")));\n\n  const showError = () => __jsx(\"div\", {\n    className: \"alert alert-danger\",\n    style: {\n      display: error ? \"\" : \"none\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 182\n    },\n    __self: this\n  }, error);\n\n  const showSuccess = () => __jsx(\"div\", {\n    className: \"alert alert-success\",\n    style: {\n      display: success ? \"\" : \"none\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 191\n    },\n    __self: this\n  }, \"Profile updated\");\n\n  const showLoading = () => __jsx(\"div\", {\n    className: \"alert alert-info\",\n    style: {\n      display: loading ? \"\" : \"none\"\n    },\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 200\n    },\n    __self: this\n  }, \"Loading...\");\n\n  return __jsx(React.Fragment, {\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"container\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"row\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211\n    },\n    __self: this\n  }, __jsx(\"div\", {\n    className: \"col-md-4 mt-5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212\n    },\n    __self: this\n  }, __jsx(ReactImageFallback, {\n    src: `${API}/user/photo/${username_for_photo}`,\n    className: \"img img-fluid img-thumbnail mb-3\",\n    fallbackImage: \"/static/default.svg\",\n    style: {\n      maxHeight: \"auto\",\n      maxWidth: \"100%\"\n    },\n    alt: \"user profile\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 213\n    },\n    __self: this\n  })), __jsx(\"div\", {\n    className: \"col-md-8  mt-5\",\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 221\n    },\n    __self: this\n  }, showSuccess(), showError(), showLoading(), profileUpdateForm()))));\n};\n\nexport default ProfileUpdate;","map":{"version":3,"sources":["/Users/huirenchuah/Desktop/travelblog/frontend/components/auth/ProfileUpdate.js"],"names":["Link","useState","useEffect","Router","getCookie","isAuth","updateUser","getProfile","update","API","ReactImageFallback","Button","ProfileUpdate","values","setValues","username","name","email","about","password","error","success","loading","userData","FormData","username_for_photo","token","init","then","data","handleChange","e","value","target","files","set","handleSubmit","preventDefault","console","log","profileUpdateForm","classes","button","showError","display","showSuccess","showLoading","maxHeight","maxWidth"],"mappings":"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","sourcesContent":["import Link from \"next/link\";\nimport { useState, useEffect } from \"react\";\nimport Router from \"next/router\";\nimport { getCookie, isAuth, updateUser } from \"../../actions/auth\";\nimport { getProfile, update } from \"../../actions/user\";\nimport { API } from \"../../config\";\nimport ReactImageFallback from \"react-image-fallback\";\nimport { Button } from \"@material-ui/core\";\n\nconst ProfileUpdate = () => {\n  const [values, setValues] = useState({\n    username: \"\",\n    name: \"\",\n    email: \"\",\n    about: \"\",\n    password: \"\",\n    error: false,\n    success: false,\n    loading: false,\n    userData: process.browser && new FormData(),\n    username_for_photo: \"\"\n  });\n\n  const token = getCookie(\"token\");\n  const {\n    username,\n    name,\n    email,\n    about,\n    password,\n    error,\n    success,\n    loading,\n    username_for_photo,\n    userData\n  } = values;\n\n  const init = () => {\n    getProfile(token).then(data => {\n      if (data.error) {\n        setValues({ ...values, error: data.error });\n      } else {\n        setValues({\n          ...values,\n          username: data.username,\n          username_for_photo: data.username,\n          name: data.name,\n          email: data.email,\n          about: data.about\n        });\n      }\n    });\n  };\n\n  useEffect(() => {\n    init();\n    setValues({ ...values, userData: new FormData() });\n  }, []);\n\n  const handleChange = name => e => {\n    // console.log(e.target.value);\n\n    let value = name === \"photo\" ? e.target.files[0] : e.target.value;\n\n    userData.set(name, value);\n\n    setValues({\n      ...values,\n      [name]: value,\n      userData,\n      error: false,\n      success: false\n    });\n    // console.log(...userData)\n  };\n\n  const handleSubmit = e => {\n    e.preventDefault();\n    console.log(...userData);\n    setValues({ ...values, loading: true });\n    update(token, userData).then(data => {\n      if (data.error) {\n        setValues({\n          ...values,\n          error: data.error,\n          success: false,\n          loading: false\n        });\n      } else {\n        // console.log(data)\n        updateUser(data, () => {\n          setValues({\n            ...values,\n            // usernameImgSrc: data.username,\n            username: data.username,\n            name: data.name,\n            email: data.email,\n            about: data.about,\n            password: \"\",\n            success: true,\n            loading: false\n          });\n        });\n      }\n    });\n  };\n\n  const profileUpdateForm = () => (\n    <form onSubmit={handleSubmit} className=\"pl-5\">\n      <div className=\"form-group\">\n        <label className=\"\">\n          <Button\n            variant=\"contained\"\n            color=\"default\"\n            className={classes.button}\n            startIcon={<CloudUploadIcon />}\n          >\n            Featured photo\n            <input\n              onChange={handleChange(\"photo\")}\n              type=\"file\"\n              accept=\"image/*\"\n              hidden\n            />\n          </Button>\n        </label>\n      </div>\n      <div className=\"form-group\">\n        <label className=\"text-muted\">Username</label>\n        <input\n          onChange={handleChange(\"username\")}\n          type=\"text\"\n          value={username}\n          className=\"form-control\"\n        />\n      </div>\n      <div className=\"form-group\">\n        <label className=\"text-muted\">Name</label>\n        <input\n          onChange={handleChange(\"name\")}\n          type=\"text\"\n          value={name}\n          className=\"form-control\"\n        />\n      </div>\n      <div className=\"form-group\">\n        <label className=\"text-muted\">Email</label>\n        <input\n          onChange={handleChange(\"email\")}\n          type=\"text\"\n          value={email}\n          className=\"form-control\"\n        />\n      </div>\n      <div className=\"form-group\">\n        <label className=\"text-muted\">About</label>\n        <textarea\n          onChange={handleChange(\"about\")}\n          type=\"text\"\n          value={about}\n          className=\"form-control\"\n        />\n      </div>\n      <div className=\"form-group\">\n        <label className=\"text-muted\">Password</label>\n        <input\n          onChange={handleChange(\"password\")}\n          type=\"password\"\n          value={password}\n          className=\"form-control\"\n        />\n      </div>\n      <div>\n        <Button variant=\"contained\" color=\"primary\" type=\"submit\">\n          Submit\n        </Button>\n      </div>\n    </form>\n  );\n\n  const showError = () => (\n    <div\n      className=\"alert alert-danger\"\n      style={{ display: error ? \"\" : \"none\" }}\n    >\n      {error}\n    </div>\n  );\n\n  const showSuccess = () => (\n    <div\n      className=\"alert alert-success\"\n      style={{ display: success ? \"\" : \"none\" }}\n    >\n      Profile updated\n    </div>\n  );\n\n  const showLoading = () => (\n    <div\n      className=\"alert alert-info\"\n      style={{ display: loading ? \"\" : \"none\" }}\n    >\n      Loading...\n    </div>\n  );\n\n  return (\n    <React.Fragment>\n      <div className=\"container\">\n        <div className=\"row\">\n          <div className=\"col-md-4 mt-5\">\n            <ReactImageFallback\n              src={`${API}/user/photo/${username_for_photo}`}\n              className=\"img img-fluid img-thumbnail mb-3\"\n              fallbackImage=\"/static/default.svg\"\n              style={{ maxHeight: \"auto\", maxWidth: \"100%\" }}\n              alt=\"user profile\"\n            />\n          </div>\n          <div className=\"col-md-8  mt-5\">\n            {showSuccess()}\n            {showError()}\n            {showLoading()}\n            {profileUpdateForm()}\n          </div>\n        </div>\n      </div>\n    </React.Fragment>\n  );\n};\n\nexport default ProfileUpdate;\n"]},"metadata":{},"sourceType":"module"}